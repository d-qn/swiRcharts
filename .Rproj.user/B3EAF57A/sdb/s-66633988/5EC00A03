{
    "contents" : "library(dplyr)\nlibrary(parsetR)\nlibrary(htmlwidgets)\nlibrary(swiRcharts)\n\n###\t\tSETTINGS   ###\ndata.sub.file <- \"input/data.csv\"\ntranslation.file <- \"input/translation_asylumFlowsEU.csv\"\n\n\ndf <- read.csv(data.sub.file)\ntxt <- read.csv(translation.file, row.names = 1, stringsAsFactors = F)\n\n\nfor(lang in colnames(txt)) {\n  dd <- df\n\n  tmp_html <- paste0(\"flow_EU_tmp_\", lang, \".html\")\n  output.html <- paste0(\"asylumApplicationsFlow_EU_\", lang, \".html\")\n\n  # rename origin / citizen country names\n  idx <- match(paste0(\"code.\", gsub(\" \", \"\", dd$citizen)), rownames(txt))\n  stopifnot(all(!is.na(idx)))\n  dd$citizen <- txt[idx, lang]\n\n  # rename destination / geo names\n  idx <- match(paste0(\"code.\", gsub(\" \", \"\", df$geo)), rownames(txt))\n  stopifnot(all(!is.na(idx)))\n  dd$geo <- txt[idx, lang]\n\n  # rename dimensions\n  colnames(dd)[match(c(\"citizen\", \"geo\"), colnames(dd))] <- txt[c(\"origins\", \"destinations\"), lang]\n  colNums <- match(c(\"values\", txt[c(\"origins\", \"destinations\"), lang]), colnames(dd))\n\n  ps.chart <- parset(select(dd, colNums),\n    dimensions =  txt[c(\"origins\", \"destinations\"), lang],\n    # use some JavaScript to inform parset that Freq has the value\n    # http://www.buildingwidgets.com/blog/2015/9/17/week-37-parsetr\n    value = htmlwidgets::JS(\"function(d){return d.values}\"),\n    tension = 0.7, width = \"100%\", height = 450,\n    spacing = 15, duration = 300)\n\n  # overwite default padding\n  ps.chart$sizingPolicy$browser$padding <- 5\n  saveWidget(ps.chart, file = tmp_html, selfcontained = FALSE, libdir = \"js\")\n\n  swi_widget(tmp_html, output.html,\n    h2 = txt[\"title\",lang],\n    descr = txt[\"description\",lang],\n    h3 = txt[\"subtitle\",lang],\n    source = paste0(txt[\"source\",lang], \": \", \n      htmlLink(\"http://ec.europa.eu/eurostat/en/web/products-datasets/-/MIGR_ASYAPPCTZM\", txt[\"eurostat\",lang])),\n    author = paste0(\"Duc-Quang Nguyen | \", htmlLink(\"http://www.swissinfo.ch\", \"swissinfo.ch\")),\n    footer = paste0(\"<strong>\",  txt[\"footer.title\",lang], \"</strong><br>\", txt[\"footer\",lang])\n  )\n}\n\n\n\n",
    "created" : 1446291274652.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3972168117",
    "id" : "5EC00A03",
    "lastKnownWriteTime" : 1446291753,
    "path" : "~/swissinfo/2015_10_28_asylumFlows/02_plotFlows.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_source"
}